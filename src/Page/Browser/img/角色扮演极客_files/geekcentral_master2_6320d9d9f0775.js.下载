geekApp.directive('geekcentral',[function(){return{restrict:'C',bindToController:true,controller:'GeekCentral_Ctrl',controllerAs:'geekcentralctrl'};}]);geekApp.controller('GeekCentral_Ctrl',['$scope',function($scope){this.setSubdomain=function(subdomain){window.location='/'+subdomain;};}]);
if(geekApp){myApp=geekApp;}else{var myApp=angular.module('geekmodule',[]).config(['$locationProvider',function($locationProvider){$locationProvider.html5Mode(true);$locationProvider.hashPrefix('!');}]);}
myApp.config(['$sceProvider',function($sceProvider){$sceProvider.enabled(false);}]);myApp.filter('truncate',function(){return function(text,truncateLength){if(text)return text.substring(0,truncateLength);else return'';};});myApp.filter('array',function(){return function(arrayLength){arrayLength=Math.ceil(arrayLength);var arr=new Array(arrayLength);for(var i=0;i<arrayLength;i++){arr[i]=i;}
return arr;};});myApp.controller('ModuleCtrl',['$scope','$window','$http','$sce','timeZoneService','geekAnalytics',function($scope,$window,$http,$sce,timeZoneService,geekAnalytics){$scope.firstload_complete=false;$scope.module={params:{filter:{languagefilter:0,categoryfilter:0}}};$scope.subdomain_data={};$scope.getModule=function(){$scope.loading=true;var action=$scope.module.action;var headers={};if(action==='/forum/module'||action==='/image/module'||action==='/video/module'||action==='/blog/module'||action==='/geekbay/module'||action==='/marketplace/module'||action==='/geeklist/module'||action.match(/^\/api\/videos/)||action.match(/^\/api\/geekcontest\/contests/)||action==='/item/module'){action=GEEK.apiurlsPrefix+$scope.module.action;if(GEEK.useBasicAuth){headers.Authorization='Basic '+
btoa(GEEK.basicAuthUsername+':'+GEEK.basicAuthPassword);}}
$http.get(action,{params:$scope.module.params,headers:headers}).then(function(response){$scope.data=response.data;$scope.loading=false;$scope.firstload_complete=true;$scope.initModule();},function errorCallback(response){$scope.data=null;$scope.loading=false;$scope.firstload=true;});};$scope.initModule=function(){if($scope.data.config&&$scope.data.config.subtypes){$scope.module.currentSubtype=_.find($scope.data.config.subtypes,{subtype:$scope.module.params.subtype});}
if($scope.data.config&&$scope.data.config.sorttypes){$scope.module.currentSort=_.find($scope.data.config.sorttypes,{type:$scope.module.params.sort});}
if($scope.data.config&&$scope.data.config.galleries){$scope.module.currentGallery=_.find($scope.data.config.galleries,{type:$scope.module.params.gallery});}
if($scope.data.config&&$scope.data.blogs){$scope.module.currentBlog=_.find($scope.data.blogs,{blogid:$scope.module.params.blogid});}
if($scope.data.config&&$scope.data.config.filter_objecttypes){$scope.module.currentObjecttype=_.find($scope.data.config.filter_objecttypes,{objecttype:$scope.module.params.filter_objecttype});}
if($scope.data.config&&$scope.data.config.gallerytypes){$scope.module.currentGallery=_.find($scope.data.config.gallerytypes,{type:$scope.module.params.gallery});}
if($scope.data.config&&$scope.data.config.languages){$scope.module.currentLanguage=_.find($scope.data.config.languages,{languageid:$scope.module.params.languageid});}
if($scope.data&&$scope.data.forums){$scope.module.currentForum=_.find($scope.data.forums,{forumid:$scope.module.params.forumid});}
if($scope.data&&$scope.data.subdomains){$scope.module.currentSubdomain=_.find($scope.data.subdomains,{subdomainid:$scope.module.params.subdomainid});}
if($scope.data&&$scope.data.config&&$scope.data.config.browsestatusoptions){$scope.module.currentReleaseStatus=_.find($scope.data.config.browsestatusoptions,{type:$scope.module.params.releasestatus});}
if($scope.type==='contest'){_.each($scope.data,function(contest,index){var timezone=timeZoneService.timezone;var m=moment(contest.endDate);contest.endDateMoment=m.fromNow();contest.endDatePrefix='Ends';contest.active=true;if(m.isBefore()){contest.active=false;contest.endDatePrefix='Ended';contest.title+=' - Results';contest.url+='/results';}});}};$scope.setReleaseStatus=function(releasestatus){$scope.module.params.releasestatus=releasestatus.type;$scope.module.currentReleaseStatus=releasestatus;};$scope.setSubdomain=function(subdomain){$scope.module.params.subdomainid=subdomain.subdomainid;$scope.module.currentSubdomain=subdomain;};$scope.setForum=function(forum){$scope.module.params.forumid=forum.forumid;$scope.module.currentGallery=forum;};$scope.setLanguage=function(lang){$scope.module.params.languageid=lang.languageid;$scope.module.currentLanguage=lang;};$scope.setGallery=function(g){$scope.module.params.gallery=g.type;$scope.module.currentGallery=g;};$scope.setObjecttype=function(ot){$scope.module.params.filter_objecttype=ot.objecttype;$scope.module.currentObjecttype=ot;};$scope.setBlog=function(blog){$scope.module.params.blogid=blog.blogid;$scope.module.currentBlog=blog;};$scope.setSubdomainId=function(subdomainid){$scope.module.params.subdomainid=subdomainid;$scope.module.params.pageid=1;};$scope.setLinkedForumIndex=function(linkedforum_index){$scope.module.params.linkedforum_index=linkedforum_index;$scope.module.params.pageid=1;};$scope.setForumid=function(forumid,forumname){$scope.module.params.forumid=forumid;$scope.module.params.pageid=1;geekAnalytics.sendEvent('forum',$scope.module.action,forumname);};$scope.setSubtype=function(st){$scope.module.currentSubtype=st;$scope.module.params.subtype=st.subtype;$scope.module.params.pageid=1;geekAnalytics.sendEvent('subtype',$scope.module.action,st.name);};$scope.setGallery=function(g){$scope.module.params.gallery=g.type;$scope.module.params.pageid=1;geekAnalytics.sendEvent('gallery',$scope.module.action,g.name);};$scope.setSort=function(sort){$scope.module.params.sort=sort;$scope.module.params.pageid=1;geekAnalytics.sendEvent('sort',$scope.module.action,sort);};$scope.setPage=function(pageid){$scope.module.params.pageid=pageid;geekAnalytics.sendEvent('pager',$scope.module.action,'setPage');};$scope.pageToFirst=function(){$scope.module.params.pageid=1;geekAnalytics.sendEvent('pager',$scope.module.action,'pageToFirst');};$scope.pageForward=function(){if(!$scope.data.config.endpage||$scope.module.params.pageid<$scope.data.config.endpage){$scope.module.params.pageid++;geekAnalytics.sendEvent('pager',$scope.module.action,'pageForward');}};$scope.pageBackward=function(){if($scope.module.params.pageid>1){$scope.module.params.pageid--;geekAnalytics.sendEvent('pager',$scope.module.action,'pageBackward');}};$scope.recordEvent=function(action,label){geekAnalytics.sendEvent(action,$scope.module.action,label);};$scope.filterContest=function(contest){return(($scope.module.currentContestFilter.type==='active'&&contest.active)||($scope.module.currentContestFilter.type==='ended'&&!contest.active));};$scope.to_trusted=function(html_code){return $sce.trustAsHtml(html_code);};$scope.sendPost=function(url){$http.post(url);};$scope.$watch('subdomain_data.subdomain',function(newVal,oldVal){if(newVal&&newVal!==oldVal){window.location='/'+newVal;}});$scope.$watch('module.params',function(){$scope.getModule();},true);}]);
geekApp.directive('geekcentralModulePager',[function(){return{restrict:'E',templateUrl:'geekcentral_module_pager.tpl'};}]);geekApp.directive('geekcentralModuleSort',[function(){return{restrict:'E',templateUrl:'geekcentral_module_sort.tpl'};}]);geekApp.directive('geekcentralPageLoad',[function(){return{restrict:'E',templateUrl:'geekcentral_module_pageload.tpl'};}]);
geekApp.directive('moduleLoading',[function(){return{restrict:'E',templateUrl:'geekcentral_module_loading.tpl'};}]);
geekApp.directive('microadminModule',[function(){return{restrict:'A',controller:'MicroAdminCtrl',controllerAs:'$ctrl',bindToController:true};}]);myApp.controller('MicroAdminCtrl',['$http',function($http){this.$onInit=function(){this.firstload_complete=false;this.getMicroAdminStats();};this.getMicroAdminStats=function(){var that=this;$http.get('/api/admin/microstats').then(function(response){that.data=response.data;that.firstload_complete=true;});};}]);
geekApp.config(['$stateProvider','$urlRouterProvider',function($stateProvider,$urlRouterProvider){$urlRouterProvider.rule(function($injector,$location){var path=$location.path();var hasTrailingSlash=path[path.length-1]==='/';if(hasTrailingSlash){return path.substr(0,path.length-1);}});$stateProvider.state('geekcentral',{url:'/',template:'GeekCentral here: <geekcentral></geekcentral>'});}]);
